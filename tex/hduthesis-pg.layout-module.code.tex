\ExplSyntaxOn \makeatletter
\hduthesis_provide_module:n {pg.layout}

\geometry { top = 2.75cm, bottom = 2cm, left = 3.2cm, right = 3.2cm,
            headheight = 15pt, headsep = .72cm }
\chead{\raisebox{.12ex}{\small 杭州电子科技大学硕士学位论文}}\lhead{}\rhead{}

\cs_new_protected_nopar:Nn \__hduthesis_cover_pg_aux:
  {
    \begin{center}
      \null
      \includegraphics[scale = 1.6]{hdubadge}
      \par \vspace*{42\p@}
        { \LARGE\l_spread_box:nn {.575\linewidth} {硕士学位论文} }
      \par\vspace*{98\p@}
      \semiLarge 题\qquad 目：
      \l_center_box:nn { .75\linewidth } { \kaishu \l__docinfo_cntitle_tl }
      \vspace*{21\p@}\par
      \begin{tabular}
        { >{\semiLarge\centering\arraybackslash}p{4\ccwd}@{}
          >{\semiLarge\centering\arraybackslash\kaishu}p{.65\linewidth} }
        \l_spread_box:nn { 4\ccwd } { 研究生 } &
        \l_center_box:nn { .96\linewidth }
                         { \seq_item:Nn \l__author_tmp_seq {1} }\\[.8ex]
        \l_spread_box:nn { 4\ccwd } { 专业 } &
        \l_center_box:nn { .96\linewidth } { \l__docinfo_major_tl }\\[.8ex]
        \l_spread_box:nn { 4\ccwd } { 指导教师 } &
        \l_center_box:nn { .96\linewidth }
                         { \l__docinfo_cnsupervisor_tl\qquad 教授 }\\[13.5ex]
        \semilarge 完成日期 &
        \l_center_box:nn { .96\linewidth }
                         { \semilarge
                           \textsf{\int_use:N \c_sys_year_int} 年
                           \textsf{\int_use:N \c_sys_month_int} 月
                         }
      \end{tabular}
    \end{center}
  }

\cs_new_protected_nopar:Nn \__hduthesis_cnoverleaf_pg_aux:
  {
    \begin{center}
      \vspace*{25\p@}{
        \LARGE 杭州电子科技大学硕士学位论文}
        \vspace*{142\p@} \par
        \begin{spacing}{1.15}
          \huge\textsf{\l__docinfo_cntitle_tl}
        \end{spacing}
        \vspace*{125\p@} \par
        \begin{tabular}{>{\large}p{7\ccwd}@{}>{\large\kaishu}p{.43\linewidth}}
          \l_spread_box:nn { 4em } {研究生}：& 
          \l_spread_box:nn { 5\ccwd } { \l__docinfo_cnauthor_tl }\\[2ex]
          \l_spread_box:nn { 4em } {指导教师}：&
          \l_spread_box:nn { 5\ccwd }
                           { \l__docinfo_cnsupervisor_tl } \qquad 教授\\[11ex] &
          \quad \textsf{\int_use:N \c_sys_year_int} 年
                \textsf{\int_use:N \c_sys_month_int} 月
        \end{tabular}
    \end{center}
  }

\cs_new_protected_nopar:Nn \__hduthesis_enoverleaf_pg_aux:
  {
    \begin{center}
      \vspace*{25\p@}{\bfseries
        Dissertation~Submitted~to~Hangzhou~Dianzi~University\\[.8ex]
        for~the~Degree~of~Master}
      \vspace*{124\p@} \par
      \begin{spacing}{1.09}
        \huge\bfseries\l__docinfo_entitle_tl
      \end{spacing}
      \vspace*{114\p@} \par
      \begin{tabular}
        { >{\bfseries\large}p{7.5\ccwd}@{}
          >{\bfseries\large}p{.32\linewidth}
        }
        \l_spread_box:nn { 4.65em } {Candidate}: &
        \l__docinfo_enauthor_tl\\[3.5ex]
        \l_spread_box:nn { 4.65em } {Supervisor}: &
        Prof.~\l__docinfo_ensupervisor_tl\\[11ex]
      \end{tabular}
      \vspace*{5\p@}\par
      \bfseries\clist_item:Nn
      \g_system_month_clist {\int_use:N \c_sys_month_int},~
      \int_use:N \c_sys_year_int
    \end{center}
  }

\cs_new_protected_nopar:Nn \__hduthesis_promise_pg_aux:
  {
    \vspace*{-12\p@}
    \begin{center}
      \large
      杭州电子科技大学\\[1ex] 学位论文原创性声明和使用授权说明
    \end{center}
    \vspace*{15\p@}
    \begin{center}
      \semilarge 原创性声明
    \end{center}
    \par \vspace*{.5\baselineskip}
    \begin{spacing}{1.65}
      本人郑重声明：所呈交的学位论文，是本人在导师的指导下，独立进行研究工作所取得的成果。
      除文中已经注明引用的内容外，本论文不含任何其他个人或集体已经发表或撰写过的作品或成果。
      对本文的研究做出重要贡献的个人和集体，均已在文中以明确方式标明。\par
      \noindent 申请学位论文与资料若有不实之处，本人承担一切相关责任。
      \par \vspace*{\baselineskip}
      \noindent \makebox[.45\linewidth][l]{论文作者签名：}
      日期：\qquad 年\qquad 月\qquad 日
      \par\vspace*{35\p@}
      \begin{center}
        \semilarge 学位论文使用授权说明
      \end{center}
      \par \vspace*{.5\baselineskip}
      \begin{spacing}{1.65}
        本人完全了解杭州电子科技大学关于保留和使用学位论文的规定，
        即：研究生在校攻读学位期间论文工作的知识产权单位属杭州电子科技大学。
        本人保证毕业离校后，发表论文或使用论文工作成果时署名单位仍然为杭州电子科技大学。
        学校有权保留送交论文的复印件，允许查阅和借阅论文；学校可以公布论文的全部或部分内容，
        可以允许采用影印、缩印或其它复制手段保存论文。（保密论文在解密后遵守此规定）
        \par \vspace*{\baselineskip}
        \noindent \makebox[.45\linewidth][l]{论文作者签名：}
        日期：\qquad 年\qquad 月\qquad 日
        \par \vspace*{\baselineskip}
        \noindent \makebox[.45\linewidth][l]{指导教师签名：}
        日期：\qquad 年\qquad 月\qquad 日
      \end{spacing}
    \end{spacing}
  }

\RenewDocumentCommand \maketitle {}
  {
    \newgeometry{margin = 2.75cm}
    \begin{titlepage}
      \__hduthesis_cover_pg_aux:
    \end{titlepage}
    \titlepage
    \__hduthesis_cnoverleaf_pg_aux:
    \endtitlepage
    \titlepage
      \__hduthesis_enoverleaf_pg_aux:
    \endtitlepage
    \titlepage
      \__hduthesis_promise_pg_aux:
    \endtitlepage
    \restoregeometry
  }

\RenewDocumentEnvironment {abstract} { O{en} }
  {
    \str_if_eq:nnT {#1} {en}
    {
      \tl_set:Nn \l__keywords_name_tl {Keywords:~}
      \tl_set:Nn \l__keywords_sep_tl {,~}
    }
    \str_if_eq:nnT {#1} {cn}
    {
      \tl_set:Nn \l__keywords_name_tl {\textsf{关键词：}}
      \tl_set:Nn \l__keywords_sep_tl {，}
    }
    \@beginparpenalty\@lowpenalty
    \str_if_eq:nnT {#1} {cn}
      {
        \chapter*{摘要}
        \addcontentsline{toc}{chapter}{摘要}
      }
    \str_if_eq:nnT {#1} {en}
      {
        \chapter*{\normalfont\bfseries Abstract}
        \addcontentsline{toc}{chapter}{\bfseries Abstract}
      }
  }
  {
    \par\null
    \tl_clear:N \l__abstract_name_tl
    \cfoot{}
    \clearpage
  }

\clist_new:N \l__abstract_keywords_clist
\NewDocumentCommand \keywords { m }
  {
    \par \vspace*{\baselineskip}
    \noindent\textbf{\l__keywords_name_tl}
    \clist_set:Nn \l__abstract_keywords_clist {#1}
    \clist_use:Nn \l__abstract_keywords_clist {\l__keywords_sep_tl}
  }

\hook_gput_code:nnn { cmd/tableofcontents/after } { . }
  { \thispagestyle{fancy} }
\RequirePackage{tocloft}
\renewcommand{\contentsname}{\hfill 目录 \hfill}
\renewcommand \cfttoctitlefont{\sffamily\semiLarge}
\dim_set:Nn \cftbeforetoctitleskip {12pt}
\dim_set:Nn \cftaftertoctitleskip {24pt}
\dim_set:Nn \cftbeforechapskip {1pt}
\dim_set:Nn \cftbeforesecskip {-.2pt}
\renewcommand*\l@chapter{\@dottedtocline{1}{0em}{1.6em}}
\renewcommand*\l@section{\@dottedtocline{1}{2.3em}{2.1em}}
\renewcommand*{\@dotsep}{1.7}
\renewcommand*{\@pnumwidth}{2.5ex}
\renewcommand{\cftchapfont}{\normalfont}
\setcounter{tocdepth}{1}

\ctexset
  {
    chapter    =
      {
        aftername  = \hspace{.5\ccwd}, fixskip   = true,
        beforeskip = 35pt,             afterskip = 30pt,
        format     = \sffamily\centering\semiLarge,
        pagestyle  = fancy
      },
    section    =
      {
        aftername  = \hspace{.5\ccwd}, fixskip   = true,
        beforeskip = 2ex,              afterskip = 2.5ex,
        format = \sffamily\large
         ,
      },
    subsection =
      {
        aftername  = \hspace{.5\ccwd}, fixskip   = true,
        beforeskip = 2ex,           afterskip = 3ex,
        format     = \sffamily\semilarge
      }
  }

\makeatother \ExplSyntaxOff
\endinput
